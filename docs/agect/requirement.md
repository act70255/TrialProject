# 雲端檔案管理系統需求分析（MVP）

## 1. 文件目的
本文件依據 `docs/reference/Design Pattern 考題 - 林敬綸.docx` 進行需求整理，目標是定義 MVP 範圍，作為後續 UML、ER Model 與 C# 實作基準。

## 2. 題目目標與交付項目
### 2.1 目標
建立一個可在 Console、Web API 與 Website 驗證的雲端檔案管理系統核心模型與邏輯，重點為物件導向分析與實作。

### 2.2 必要交付
1. UML Class Diagram（需含 Inheritance / Association / Aggregation or Composition）
2. ER Model 圖（Schema 設計）
3. 程式碼實作（C#）
4. 功能執行結果驗證（需可於 Console、Web API、Website 三種介面驗證）
5. 設計與實作概念說明（README/文件）
6. GitHub Repository 連結（含可檢視之完整程式碼與文件）

## 3. 領域需求（Domain Requirements）
### 3.1 檔案類型
系統需支援以下檔案：
- Word 文件
- 圖片
- 純文字檔

### 3.2 共通屬性
所有檔案都需具備：
- 檔名（Name）
- 大小（Size，顯示單位為 KB）
- 建立時間（CreatedTime）

### 3.3 類型專屬屬性
- Word 檔：頁數（PageCount）
- 圖片：解析度（Width, Height）
- 純文字檔：編碼（Encoding，例如 UTF-8）

### 3.4 目錄與結構規則
- 以「目錄（Directory）」管理檔案。
- 目錄可包含多個檔案。
- 目錄可包含子目錄，層級不限（遞迴樹狀）。
- 目錄本身具備名稱。
- 所有檔案必須隸屬某個目錄，不可獨立存在。

## 4. 範例初始化資料（依題目示意）
需可建立以下結構（摘要）：
- Root
  - Project_Docs
    - 需求規格書.docx（頁數 15，大小 500KB）
    - 系統架構圖.png（1920x1080，大小 2MB）
  - Personal_Notes
    - 待辦清單.txt（UTF-8，大小 1KB）
    - Archive_2025
      - 舊會議記錄.docx（頁數 5，大小 200KB）
  - README.txt（ASCII，大小 500B）

> 單位規則補充：題目示意含 `MB` 與 `B`，系統顯示與驗收時一律轉為 `KB`（固定單位）。

## 5. 實作功能要求（依題目順序）

### 5.1 實作功能一：目錄結構呈現【MVP｜對應題目：實作功能 1-1】
1. 初始化：依題目範例建立目錄與檔案物件樹。
2. 顯示：可呈現完整目錄結構與檔案細節（頁數/解析度/編碼/大小/建立時間）。
3. 驗證介面：Console、Web API、Website 三種介面皆可檢視結果。

### 5.2 實作功能二：核心邏輯（Console 呈現功能結果）【MVP｜對應題目：實作功能 2】

#### 5.2.1 遞迴計算總容量（Calculate Total Size）【對應題目：實作功能 2-1】
- 提供方法計算任一目錄底下所有子目錄與檔案總大小。
- 計算需包含多層子目錄內容。
- 檔案大小顯示與驗收固定使用 KB；來源若為 MB 或 B，需先換算為 KB。
- 單位換算規則：`1MB = 1024KB`、`1KB = 1024B`。
- KB 顯示建議統一至小數第 3 位（四捨五入）以避免跨介面顯示差異。

#### 5.2.2 副檔名搜尋（Search by Extension）【對應題目：實作功能 2-2】
- 輸入副檔名（例如 `.docx`）。
- 回傳該目錄樹中所有符合檔案的完整路徑。
- 搜尋結果需完整且可重現，避免遺漏或重複。

#### 5.2.3 XML 結構輸出（XML Serialization）【對應題目：實作功能 2-3】
- 提供方法將當前目錄樹轉換為 XML 並輸出。
- 輸出結構語意需對齊題目示例（包含目錄層級與檔案描述內容）。
- 驗收以「結構層級與內容語意一致」為準，不強制節點名稱逐字對齊題目範例。

### 5.3 實作功能三：功能進度追蹤（Process Logging）【MVP｜對應題目：實作功能 3-1】
1. 演算法執行紀錄：執行「計算大小」與「搜尋」時，Console 印出 Traverse Log。
2. 訪問順序可視：需可觀察當前訪問節點順序，以證明遍歷過程（例如：`Visiting: Root -> Project_Docs -> 需求規格書.docx`）。

### 5.4 實作功能四：進階功能（Bonus）【Phase 2 / MMP｜對應題目：實作功能 4】

#### B1 排序功能【對應題目：實作功能 4-1】
- 支援依 `名稱`、`大小`、`副檔名` 進行排序。
- 每種排序鍵皆支援 `升冪` 與 `降冪`。
- 排序採「全域環境設定」模式：設定後對後續清單查詢（如 `lsr`）一律套用，不區分目錄 scope。
- `sort` 指令本身以目前目錄為輸出範圍（遞迴列出當前目錄全部子孫）供即時檢視。
- 同鍵值項目需維持穩定排序（Stable Sort），並以建立順序作為次要順序。
- 排序結果可於 Console、Web API、Website 至少擇一介面驗證；若三介面皆已實作，需保持一致。

#### B2 編輯功能【對應題目：實作功能 4-2】
- 支援節點 `刪除`。
- 支援節點 `複製/貼上`。
- 目錄複製需為深拷貝（含子節點與屬性），不得與來源共用可變狀態。
- 名稱衝突需採明確策略（預設 `Reject`），不得覆蓋既有節點。
- 操作後須能反映於目錄樹輸出與總容量/搜尋結果。

#### B3 標籤功能【對應題目：實作功能 4-3】
- 支援標籤：`Urgent（紅色）`、`Work（藍色）`、`Personal（綠色）`。
- 每個節點可套用多重標籤。
- 本次驗收採固定標籤集合（僅上述三種），不納入自訂/新增/刪除標籤管理功能。
- 查詢與顯示需能辨識標籤內容與顏色語意。

#### B4 狀態管理（Undo / Redo）【對應題目：實作功能 4-4】
- 針對可編輯操作（本版聚焦：排序設定、標籤新增/移除）支援復原與重做。
- 每次操作需保留可追溯歷程，並可正確回放。
- Undo/Redo 採單一工作階段（Session）雙堆疊模型；執行新操作後需清空 Redo 堆疊。

## 6. 非功能需求與限制
- 系統需同時提供 Console、Web API、Website 三種操作/驗證介面。
- 本次採 Full Scope 驗收，Website 需覆蓋 Bonus 對應功能與驗證結果。
- 程式需可讀、可維護，並符合清楚分層設計。
- 資料儲存策略：開發階段 SQLite，保留 SQL Server 部署彈性（此為實作策略加值，非題目強制要求，於後續架構文件詳述）。

## 7. 範圍說明（Scope Statement）
本文件目前不設 Out of Scope 清單。

功能以 `MVP` 與 `Phase 2 / MMP` 分級：
1. `MVP`：對應題目「實作功能一～三」與核心邏輯驗收基線。
2. `Phase 2 / MMP`：對應題目「實作功能四（Bonus）」之可用性強化項目。
3. 本次專案驗收策略採 `Full Scope`：`MVP` 與 `Phase 2 / MMP` 皆納入必驗，不以 `N/A` 排除 Bonus。

## 8. 驗收標準

### 8.1 MVP 驗收標準
1. 能正確建立並輸出題目指定目錄樹。
2. 能正確計算任一目錄總大小（含遞迴）。
3. 能依副檔名搜尋並輸出完整路徑。
4. 能輸出符合需求語意的 XML 結果。
5. 計算與搜尋流程均有 Traverse Log 可驗證遍歷過程。
6. 上述核心功能可於 Console、Web API、Website 三種介面完成操作與驗證。

### 8.2 Phase 2 / MMP 驗收標準（對應 Bonus，本次納入必驗）
1. 可依名稱/大小/副檔名進行升冪與降冪排序。
2. 可完成刪除與複製/貼上，且結果正確反映在目錄樹與相關功能輸出。
3. 可為節點套用單一或多重標籤，且可正確顯示標籤語意。
4. 可對支援操作進行 Undo/Redo，並保持狀態一致。

## 9. 後續文件對應
- `docs/reference/requirement.md`：本文件（需求基準）
- `delivery/UMLClassDirgram.md`：UML 類別圖與類別說明
- `delivery/ERModel.md`：ER 圖與資料欄位設計
- `docs/agect/architecture.md`：三層架構與技術決策
- `README.md`：執行方式、示範輸出、設計摘要

## 10. 題目實作功能追溯（Traceability）
1. 對應題目「實作功能 1-1（目錄結構呈現）」→ 本文件 `5.1`、`8.1`。
2. 對應題目「實作功能 2-1（遞迴計算總容量）」→ 本文件 `5.2.1`、`8.1`。
3. 對應題目「實作功能 2-2（副檔名搜尋）」→ 本文件 `5.2.2`、`8.1`。
4. 對應題目「實作功能 2-3（XML 結構輸出）」→ 本文件 `5.2.3`、`8.1`。
5. 對應題目「實作功能 3-1（功能進度追蹤）」→ 本文件 `5.3`、`8.1`。
6. 對應題目「實作功能 4-1（排序功能）」→ 本文件 `5.4` 的 `B1`、`8.2`。
7. 對應題目「實作功能 4-2（編輯功能）」→ 本文件 `5.4` 的 `B2`、`8.2`。
8. 對應題目「實作功能 4-3（標籤功能）」→ 本文件 `5.4` 的 `B3`、`8.2`。
9. 對應題目「實作功能 4-4（狀態管理 Undo / Redo）」→ 本文件 `5.4` 的 `B4`、`8.2`。
